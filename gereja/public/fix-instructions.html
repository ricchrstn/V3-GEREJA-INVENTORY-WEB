<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Instructions - HKBP Setia Mekar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .step { background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #2196f3; }
        .step h3 { margin-top: 0; color: #1976d2; }
        .code { background: #f5f5f5; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 14px; margin: 10px 0; border: 1px solid #ddd; }
        .success { background: #e8f5e8; border-left-color: #4caf50; }
        .success h3 { color: #2e7d32; }
        .warning { background: #fff3e0; border-left-color: #ff9800; }
        .warning h3 { color: #f57c00; }
        .error { background: #ffebee; border-left-color: #f44336; }
        .error h3 { color: #d32f2f; }
        .btn { display: inline-block; background: #2196f3; color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px; margin: 5px; }
        .btn:hover { background: #1976d2; }
        .btn.success { background: #4caf50; }
        .btn.danger { background: #f44336; }
        .checklist { list-style: none; padding: 0; }
        .checklist li { padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #ddd; }
        .checklist li.done { border-left-color: #4caf50; background: #e8f5e8; }
        .checklist li.error { border-left-color: #f44336; background: #ffebee; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1><i class="fas fa-tools"></i> Fix Instructions - HKBP Setia Mekar</h1>
            <p>Panduan lengkap untuk mengatasi masalah "Failed to fetch" dan CRUD operations</p>
            
            <div class="step error">
                <h3><i class="fas fa-exclamation-triangle"></i> Masalah yang Ditemukan</h3>
                <ul>
                    <li>❌ Network Error: Failed to fetch</li>
                    <li>❌ /pengurus/barang - tidak dapat diakses</li>
                    <li>❌ /pengurus/barang/create - tidak dapat diakses</li>
                    <li>❌ CRUD operations tidak berfungsi</li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-list-ol"></i> Langkah-langkah Perbaikan</h2>
            
            <div class="step">
                <h3><i class="fas fa-server"></i> Step 1: Pastikan Server Laravel Berjalan</h3>
                <p>Buka Command Prompt/Terminal dan jalankan:</p>
                <div class="code">
cd c:\laragon\www\gereja
php artisan serve
                </div>
                <p>Atau jika menggunakan Laragon, pastikan Apache dan MySQL sudah running.</p>
                <p><strong>Test:</strong> Buka <a href="/test-server" target="_blank">http://localhost/gereja/test-server</a></p>
            </div>

            <div class="step">
                <h3><i class="fas fa-database"></i> Step 2: Setup Database</h3>
                <p>Pastikan database sudah dibuat dan migrasi sudah dijalankan:</p>
                <div class="code">
php artisan migrate
php artisan db:seed
                </div>
                <p>Jika belum ada database, buat database baru bernama <code>gereja</code> di phpMyAdmin.</p>
            </div>

            <div class="step">
                <h3><i class="fas fa-user-lock"></i> Step 3: Login ke Sistem</h3>
                <p>Buka halaman login dan masuk dengan akun yang tersedia:</p>
                <div class="code">
URL: http://localhost/gereja/login

Akun Pengurus:
Email: pengurus1@mail.com
Password: pengurus123

Akun Admin:
Email: admin@gmail.com
Password: admin123
                </div>
                <p><strong>Penting:</strong> Harus login dulu sebelum mengakses halaman CRUD!</p>
            </div>

            <div class="step">
                <h3><i class="fas fa-route"></i> Step 4: Test Routes</h3>
                <p>Setelah login, test routes berikut:</p>
                <ul>
                    <li><a href="/pengurus/dashboard" target="_blank">Dashboard Pengurus</a></li>
                    <li><a href="/pengurus/barang" target="_blank">Halaman Barang</a></li>
                    <li><a href="/pengurus/barang/create" target="_blank">Tambah Barang</a></li>
                    <li><a href="/pengurus/kategori" target="_blank">Halaman Kategori</a></li>
                </ul>
            </div>

            <div class="step">
                <h3><i class="fas fa-cog"></i> Step 5: Test Components</h3>
                <p>Gunakan file test untuk memverifikasi komponen:</p>
                <ul>
                    <li><a href="/test-connection.html" target="_blank" class="btn">Test Connection</a></li>
                    <li><a href="/debug-crud.html" target="_blank" class="btn">Debug CRUD</a></li>
                    <li><a href="/test-final.html" target="_blank" class="btn success">Test Modal</a></li>
                </ul>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-bug"></i> Troubleshooting</h2>
            
            <div class="step warning">
                <h3><i class="fas fa-exclamation-triangle"></i> Jika Masih "Failed to fetch"</h3>
                <p><strong>Kemungkinan penyebab:</strong></p>
                <ol>
                    <li><strong>Server tidak berjalan</strong> - Jalankan <code>php artisan serve</code></li>
                    <li><strong>Port salah</strong> - Pastikan menggunakan port yang benar (8000 untuk artisan serve)</li>
                    <li><strong>Belum login</strong> - Login dulu sebelum akses halaman CRUD</li>
                    <li><strong>CORS issues</strong> - Coba akses dari localhost, bukan 127.0.0.1</li>
                    <li><strong>Firewall</strong> - Matikan firewall sementara untuk test</li>
                </ol>
            </div>

            <div class="step warning">
                <h3><i class="fas fa-shield-alt"></i> Jika Error 302 (Redirect)</h3>
                <p>Error 302 berarti redirect, biasanya karena:</p>
                <ul>
                    <li>Belum login (diredirect ke /login)</li>
                    <li>Role tidak sesuai (admin akses pengurus route)</li>
                    <li>Session expired</li>
                </ul>
                <p><strong>Solusi:</strong> Login ulang dengan akun yang sesuai.</p>
            </div>

            <div class="step warning">
                <h3><i class="fas fa-key"></i> Jika Error CSRF Token</h3>
                <p>Pastikan meta tag CSRF ada di layout:</p>
                <div class="code">
&lt;meta name="csrf-token" content="{{ csrf_token() }}"&gt;
                </div>
                <p>Meta tag sudah ada di layout, tapi pastikan halaman menggunakan layout yang benar.</p>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-check-circle"></i> Checklist Verifikasi</h2>
            <ul class="checklist">
                <li id="server-check">
                    <i class="fas fa-server"></i> Server Laravel berjalan
                    <button onclick="testServer()" class="btn" style="float: right;">Test</button>
                </li>
                <li id="db-check">
                    <i class="fas fa-database"></i> Database terkoneksi
                    <button onclick="testDB()" class="btn" style="float: right;">Test</button>
                </li>
                <li id="login-check">
                    <i class="fas fa-user-lock"></i> User sudah login
                    <button onclick="testAuth()" class="btn" style="float: right;">Test</button>
                </li>
                <li id="routes-check">
                    <i class="fas fa-route"></i> Routes dapat diakses
                    <button onclick="testRoutes()" class="btn" style="float: right;">Test</button>
                </li>
                <li id="csrf-check">
                    <i class="fas fa-shield-alt"></i> CSRF token tersedia
                    <button onclick="testCSRF()" class="btn" style="float: right;">Test</button>
                </li>
            </ul>
        </div>

        <div class="card">
            <h2><i class="fas fa-rocket"></i> Quick Fix Commands</h2>
            <p>Jalankan perintah berikut jika masih ada masalah:</p>
            
            <div class="step">
                <h3>Clear Cache & Restart</h3>
                <div class="code">
php artisan config:clear
php artisan cache:clear
php artisan route:clear
php artisan view:clear
php artisan serve
                </div>
            </div>

            <div class="step">
                <h3>Reset Database (jika perlu)</h3>
                <div class="code">
php artisan migrate:fresh --seed
                </div>
            </div>

            <div class="step">
                <h3>Check Permissions (Linux/Mac)</h3>
                <div class="code">
chmod -R 755 storage/
chmod -R 755 bootstrap/cache/
                </div>
            </div>
        </div>
    </div>

    <script>
    async function testServer() {
        const li = document.getElementById('server-check');
        try {
            const response = await fetch('/test-server');
            if (response.ok) {
                li.className = 'done';
                li.innerHTML = '<i class="fas fa-check-circle"></i> Server Laravel berjalan ✅';
            } else {
                throw new Error('Server error');
            }
        } catch (error) {
            li.className = 'error';
            li.innerHTML = '<i class="fas fa-times-circle"></i> Server tidak berjalan ❌';
        }
    }

    async function testDB() {
        const li = document.getElementById('db-check');
        try {
            const response = await fetch('/test-server');
            const data = await response.json();
            if (data.status === 'OK') {
                li.className = 'done';
                li.innerHTML = '<i class="fas fa-check-circle"></i> Database terkoneksi ✅';
            } else {
                throw new Error('DB error');
            }
        } catch (error) {
            li.className = 'error';
            li.innerHTML = '<i class="fas fa-times-circle"></i> Database error ❌';
        }
    }

    async function testAuth() {
        const li = document.getElementById('login-check');
        try {
            const response = await fetch('/test-auth');
            const data = await response.json();
            if (data.authenticated) {
                li.className = 'done';
                li.innerHTML = `<i class="fas fa-check-circle"></i> User login: ${data.user.email} (${data.user.role}) ✅`;
            } else {
                li.className = 'error';
                li.innerHTML = '<i class="fas fa-times-circle"></i> Belum login ❌ <a href="/login">Login</a>';
            }
        } catch (error) {
            li.className = 'error';
            li.innerHTML = '<i class="fas fa-times-circle"></i> Auth test error ❌';
        }
    }

    async function testRoutes() {
        const li = document.getElementById('routes-check');
        try {
            const response = await fetch('/pengurus/barang');
            if (response.ok || response.status === 302) {
                li.className = 'done';
                li.innerHTML = '<i class="fas fa-check-circle"></i> Routes dapat diakses ✅';
            } else {
                throw new Error('Route error');
            }
        } catch (error) {
            li.className = 'error';
            li.innerHTML = '<i class="fas fa-times-circle"></i> Routes tidak dapat diakses ❌';
        }
    }

    async function testCSRF() {
        const li = document.getElementById('csrf-check');
        const csrfToken = document.querySelector('meta[name="csrf-token"]');
        
        if (csrfToken) {
            li.className = 'done';
            li.innerHTML = '<i class="fas fa-check-circle"></i> CSRF token tersedia ✅';
        } else {
            li.className = 'error';
            li.innerHTML = '<i class="fas fa-times-circle"></i> CSRF token tidak ditemukan ❌';
        }
    }

    // Auto-run tests
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
            testServer();
            setTimeout(testAuth, 1000);
            setTimeout(testCSRF, 500);
        }, 1000);
    });
    </script>
</body>
</html>